<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>GoldenFake - Verificador (Front-end)</title>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <h1>GoldenFake</h1>
    <p class="small">Ferramenta experimental de apoio à verificação. Não substitui checagem humana. Forneça uma
        afirmação ou pequeno texto.</p>

    <div class="panel">
        <div class="flex-between" style="margin-bottom:.5rem;">
            <label class="api-inline" style="margin:0;">
                <span>API base</span>
                <input id="apiBase" type="text" placeholder="ex.: http://localhost:5000" />
            </label>
            <div class="small">Endpoints: <code>POST /analyze</code> | <code>POST /train_online</code></div>
        </div>

        <label
            style="display:block; font-weight:600; margin-bottom:.5rem; font-size:.8rem; text-transform:uppercase; letter-spacing:.5px;">Texto
            para análise</label>
        <textarea id="text" placeholder="Ex: O Brasil é o maior exportador mundial de café."></textarea>
        <div class="row" style="margin-top:.5rem;">
            <label>k
                <input id="k" type="number" value="20" min="1" max="100" />
            </label>
            <label>Peso histórico
                <input id="w_hist" type="number" step="0.05" value="0.5" />
            </label>
            <label>Peso BERT
                <input id="w_bert" type="number" step="0.05" value="0.35" />
            </label>
            <label>Peso fontes
                <input id="w_fontes" type="number" step="0.05" value="0.33" />
            </label>
            <label>Hist agg
                <select id="hist_agg">
                    <option>max</option>
                    <option>mean</option>
                </select>
            </label>
            <label>BERT agg
                <select id="bert_agg">
                    <option>mean</option>
                    <option>max</option>
                </select>
            </label>
        </div>
        <div class="row">
            <label>max_tokens
                <input id="max_tokens" type="number" value="512" />
            </label>
            <label>overlap_tokens
                <input id="overlap_tokens" type="number" value="64" />
            </label>
            <label>use_wiki
                <select id="use_wiki">
                    <option>false</option>
                    <option>true</option>
                </select>
            </label>
            <label>wiki_titles
                <input id="wiki_titles" type="number" value="3" />
            </label>
            <label>w_faiss
                <input id="w_faiss" type="number" step="0.05" value="0.5" />
            </label>
            <label>w_wiki
                <input id="w_wiki" type="number" step="0.05" value="0.5" />
            </label>
        </div>
        <div class="flex-between" style="margin-top:.75rem;">
            <div>
                <button id="run">Analisar</button>
                <button id="toggleRaw" style="background:#64748b;" disabled>Mostrar detalhes</button>
            </div>
            <div class="small">Se abrir este arquivo diretamente (file://), a URL padrão será http://localhost:5000
            </div>
        </div>
    </div>

    <div id="summaryArea" style="display:none;" class="fade">
        <div class="card">
            <h2 style="margin:0 0 .75rem; font-size:1.05rem;">Resultados</h2>
            <div class="results-grid">
                <div class="metric" id="mHist">
                    <h3>Consistência Histórica</h3>
                    <div class="pct" id="pctHist">--%</div>
                    <div class="bar"><span id="barHist"></span></div>
                    <div class="status" id="stHist"></div>
                </div>
                <div class="metric" id="mBert">
                    <h3>BERT (Prob. Verdadeiro)</h3>
                    <div class="pct" id="pctBert">--%</div>
                    <div class="bar"><span id="barBert"></span></div>
                    <div class="status" id="stBert"></div>
                </div>
                <div class="metric" id="mFontes">
                    <h3>Fontes Externas</h3>
                    <div class="pct" id="pctFontes">--%</div>
                    <div class="bar"><span id="barFontes"></span></div>
                    <div class="status" id="stFontes"></div>
                </div>
                <div class="metric final" id="mFinal" style="grid-column: span 1;">
                    <h3>Média / Score Final</h3>
                    <div class="pct" id="pctFinal">--%</div>
                    <div class="bar"><span id="barFinal"></span></div>
                    <div class="status" id="stFinal"></div>
                </div>
            </div>
            <p class="small" style="margin-top:1rem;">As porcentagens resultam de três sinais combinados pelos pesos
                definidos. Use como indicação inicial, não veredicto definitivo.</p>
        </div>

        <div class="card" id="chartCard">
            <h2 style="margin:0 0 .75rem; font-size:1.05rem;">Gráfico de pizza das porcentagens</h2>
            <div class="chart-wrap">
                <canvas id="pieChart"></canvas>
            </div>
            <div id="pieFallback" class="small" style="display:none;color:#64748b;">
                Não foi possível carregar o gráfico.
            </div>
        </div>

        <div class="card" id="sourcesCard" style="display:none;">
            <h2 style="margin:0 0 .75rem; font-size:1.05rem;">Fontes externas (individuais)</h2>
            <div class="small">Percentual final por evidência considerada. Clique no título para abrir.</div>
            <div class="sources-list" id="sourcesList"></div>
        </div>
    </div>

    <div id="detailsBox" class="card fade">
        <div class="flex-between" style="margin-bottom:.5rem;">
            <strong>Detalhes completos (JSON)</strong>
            <button id="closeRaw" style="background:#e11d48;">Fechar</button>
        </div>
        <pre id="out">{}</pre>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>

</html>